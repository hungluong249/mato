(function(b){function a(g){var c=g.originalEvent.changedTouches,e=c[0],d="",f;switch(g.type){case"touchmove":d="mousemove";break;case"touchend":d="mouseup";break;default:return}f=document.createEvent("MouseEvent"),f.initMouseEvent(d,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(f),g.preventDefault()}b.fn.rateit=function(d,g){var c={},j="init",k=function(e){return e.charAt(0).toUpperCase()+e.substr(1)},h;if(this.length==0){return this}if(h=b.type(d),h=="object"||d===undefined||d==null){c=b.extend({},b.fn.rateit.defaults,d)}else{if(h=="string"&&g===undefined){return this.data("rateit"+k(d))}h=="string"&&(j="setvalue")}return this.each(function(){var m=b(this),n=function(f){return arguments[0]="rateit"+k(f),m.data.apply(m,arguments)},r,u,o,t,q,i,e;if(m.hasClass("rateit")||m.addClass("rateit"),r=m.css("direction")!="rtl",j=="setvalue"){if(!n("init")){throw"Can't set value before init"}d!="readonly"||n("readonly")||(m.find(".rateit-range").unbind(),n("wired",!1)),d=="value"&&g==null&&(g=n("min")),n("backingfld")&&(u=b(n("backingfld")),d=="value"&&u.val(g),d=="min"&&u[0].min&&(u[0].min=g),d=="max"&&u[0].max&&(u[0].max=g),d=="step"&&u[0].step&&(u[0].step=g)),n(d,g)}n("init")||(n("min",n("min")||c.min),n("max",n("max")||c.max),n("step",n("step")||c.step),n("readonly",n("readonly")!==undefined?n("readonly"):c.readonly),n("resetable",n("resetable")!==undefined?n("resetable"):c.resetable),n("backingfld",n("backingfld")||c.backingfld),n("starwidth",n("starwidth")||c.starwidth),n("starheight",n("starheight")||c.starheight),n("value",n("value")||c.value||c.min),n("ispreset",n("ispreset")!==undefined?n("ispreset"):c.ispreset),n("backingfld")&&(u=b(n("backingfld")),n("value",u.hide().val()),(u.attr("disabled")||u.attr("readonly"))&&n("readonly",!0),u[0].nodeName=="INPUT"&&(u[0].type=="range"||u[0].type=="text")&&(n("min",parseInt(u.attr("min"))||n("min")),n("max",parseInt(u.attr("max"))||n("max")),n("step",parseInt(u.attr("step"))||n("step"))),u[0].nodeName=="SELECT"&&u[0].options.length>1&&(n("min",Number(u[0].options[0].value)),n("max",Number(u[0].options[u[0].length-1].value)),n("step",Number(u[0].options[1].value)-Number(u[0].options[0].value)))),m.append('<div class="rateit-reset"></div><div class="rateit-range"><div class="rateit-selected" style="height:'+n("starheight")+'px"></div><div class="rateit-hover" style="height:'+n("starheight")+'px"></div></div>'),r||(m.find(".rateit-reset").css("float","right"),m.find(".rateit-selected").addClass("rateit-selected-rtl"),m.find(".rateit-hover").addClass("rateit-hover-rtl")),n("init",!0)),o=m.find(".rateit-range"),o.width(n("starwidth")*(n("max")-n("min"))).height(n("starheight")),t="rateit-preset"+(r?"":"-rtl"),n("ispreset")?m.find(".rateit-selected").addClass(t):m.find(".rateit-selected").removeClass(t),n("value")!=null&&(q=(n("value")-n("min"))*n("starwidth"),m.find(".rateit-selected").width(q)),i=m.find(".rateit-reset"),i.data("wired")!==!0&&i.click(function(){n("value",n("min")),o.find(".rateit-hover").hide().width(0),o.find(".rateit-selected").width(0).show(),n("backingfld")&&b(n("backingfld")).val(n("min")),m.trigger("reset")}).data("wired",!0),e=function(p,l){var f=l.changedTouches?l.changedTouches[0].pageX:l.pageX,s=f-b(p).offset().left;return r||(s=o.width()-s),s>o.width()&&(s=o.width()),s<0&&(s=0),q=Math.ceil(s/n("starwidth")*(1/n("step")))},n("readonly")?i.hide():(n("resetable")||i.hide(),n("wired")||(o.bind("touchmove touchend",a),o.mousemove(function(v){var p=e(this,v),l=p*n("starwidth")*n("step"),s=o.find(".rateit-hover"),f;s.data("width")!=l&&(o.find(".rateit-selected").hide(),s.width(l).show().data("width",l),f=[p*n("step")+n("min")],m.trigger("hover",f).trigger("over",f))}),o.mouseleave(function(){o.find(".rateit-hover").hide().width(0).data("width",""),m.trigger("hover",[null]).trigger("over",[null]),o.find(".rateit-selected").show()}),o.mouseup(function(l){var p=e(this,l),f=p*n("step")+n("min");n("value",f),n("backingfld")&&b(n("backingfld")).val(f),n("ispreset")&&(o.find(".rateit-selected").removeClass(t),n("ispreset",!1)),o.find(".rateit-hover").hide(),o.find(".rateit-selected").width(p*n("starwidth")*n("step")).show(),m.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[f])}),n("wired",!0)),n("resetable")&&i.show())})},b.fn.rateit.defaults={min:0,max:5,step:0.5,starwidth:16,starheight:16,readonly:!1,resetable:!0,ispreset:!1},b(function(){b("div.rateit").rateit()})})(jQuery);