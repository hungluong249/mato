module("Events on initialization",{setup:function(){this.input=$('<input type="text" value="31-03-2011">').appendTo("#qunit-fixture")}});test("When initializing the datepicker, it should trigger no change or changeDate events",function(){var a=0,b=0;this.input.on({change:function(){a++},changeDate:function(){b++}});this.input.datepicker({format:"dd-mm-yyyy"});equal(a,0);equal(b,0)});module("Events",{setup:function(){this.input=$('<input type="text" value="31-03-2011">').appendTo("#qunit-fixture").datepicker({format:"dd-mm-yyyy"}).focus();this.dp=this.input.data("datepicker");this.picker=this.dp.picker},teardown:function(){this.picker.remove()}});test("Selecting a year from decade view triggers changeYear",function(){var b,a=0;this.input.on("changeYear",function(){a++});equal(this.dp.viewMode,0);b=this.picker.find(".datepicker-days thead th.datepicker-switch");ok(b.is(":visible"),"View switcher is visible");b.click();ok(this.picker.find(".datepicker-months").is(":visible"),"Month picker is visible");equal(this.dp.viewMode,1);datesEqual(this.dp.viewDate,UTCDate(2011,2,31));datesEqual(this.dp.dates[0],UTCDate(2011,2,31));b=this.picker.find(".datepicker-months thead th.datepicker-switch");ok(b.is(":visible"),"View switcher is visible");b.click();ok(this.picker.find(".datepicker-years").is(":visible"),"Year picker is visible");equal(this.dp.viewMode,2);datesEqual(this.dp.viewDate,UTCDate(2011,2,31));datesEqual(this.dp.dates[0],UTCDate(2011,2,31));b=this.picker.find(".datepicker-years tbody span:contains(2010)");b.click();equal(this.dp.viewMode,1);datesEqual(this.dp.viewDate,UTCDate(2010,2,1));datesEqual(this.dp.dates[0],UTCDate(2011,2,31));equal(a,1)});test("Navigating forward/backward from month view triggers changeYear",function(){var b,a=0;this.input.on("changeYear",function(){a++});equal(this.dp.viewMode,0);b=this.picker.find(".datepicker-days thead th.datepicker-switch");ok(b.is(":visible"),"View switcher is visible");b.click();ok(this.picker.find(".datepicker-months").is(":visible"),"Month picker is visible");equal(this.dp.viewMode,1);b=this.picker.find(".datepicker-months thead th.prev");ok(b.is(":visible"),"Prev switcher is visible");b.click();ok(this.picker.find(".datepicker-months").is(":visible"),"Month picker is visible");equal(a,1);b=this.picker.find(".datepicker-months thead th.next");ok(b.is(":visible"),"Next switcher is visible");b.click();ok(this.picker.find(".datepicker-months").is(":visible"),"Month picker is visible");equal(a,2)});test("Selecting a month from year view triggers changeMonth",function(){var b,a=0;this.input.on("changeMonth",function(){a++});equal(this.dp.viewMode,0);b=this.picker.find(".datepicker-days thead th.datepicker-switch");ok(b.is(":visible"),"View switcher is visible");b.click();ok(this.picker.find(".datepicker-months").is(":visible"),"Month picker is visible");equal(this.dp.viewMode,1);datesEqual(this.dp.viewDate,UTCDate(2011,2,31));datesEqual(this.dp.dates[0],UTCDate(2011,2,31));b=this.picker.find(".datepicker-months tbody span:contains(Apr)");b.click();equal(this.dp.viewMode,0);datesEqual(this.dp.viewDate,UTCDate(2011,3,1));datesEqual(this.dp.dates[0],UTCDate(2011,2,31));equal(a,1)});test("Navigating forward/backward from month view triggers changeMonth",function(){var b,a=0;this.input.on("changeMonth",function(){a++});equal(this.dp.viewMode,0);b=this.picker.find(".datepicker-days thead th.prev");ok(b.is(":visible"),"Prev switcher is visible");b.click();ok(this.picker.find(".datepicker-days").is(":visible"),"Day picker is visible");equal(a,1);b=this.picker.find(".datepicker-days thead th.next");ok(b.is(":visible"),"Next switcher is visible");b.click();ok(this.picker.find(".datepicker-days").is(":visible"),"Day picker is visible");equal(a,2)});test("format() returns a formatted date string",function(){var c,b,a;this.input.on("changeDate",function(d){try{a=d.format()}catch(d){b=d}});equal(this.dp.viewMode,0);c=this.picker.find(".datepicker-days tbody td:nth(15)");c.click();datesEqual(this.dp.viewDate,UTCDate(2011,2,14));datesEqual(this.dp.dates[0],UTCDate(2011,2,14));equal(b,undefined);equal(a,"14-03-2011")});test("format(altformat) returns a formatted date string",function(){var c,b,a;this.input.on("changeDate",function(d){try{a=d.format("m/d/yy")}catch(d){b=d}});equal(this.dp.viewMode,0);c=this.picker.find(".datepicker-days tbody td:nth(15)");c.click();datesEqual(this.dp.viewDate,UTCDate(2011,2,14));datesEqual(this.dp.dates[0],UTCDate(2011,2,14));equal(b,undefined);equal(a,"3/14/11")});test("format(ix) returns a formatted date string of the ix'th date selected",function(){var c,b,a;this.dp._process_options({multidate:true});this.input.on("changeDate",function(d){try{a=d.format(2)}catch(d){b=d}});c=this.picker.find(".datepicker-days tbody td:nth(7)");equal(c.text(),"6");c.click();c=this.picker.find(".datepicker-days tbody td:nth(15)");equal(c.text(),"14");c.click();equal(this.dp.dates.length,3);equal(b,undefined);equal(a,"14-03-2011")});test("format(ix, altformat) returns a formatted date string",function(){var c,b,a;this.dp._process_options({multidate:true});this.input.on("changeDate",function(d){try{a=d.format(2,"m/d/yy")}catch(d){b=d}});c=this.picker.find(".datepicker-days tbody td:nth(7)");equal(c.text(),"6");c.click();c=this.picker.find(".datepicker-days tbody td:nth(15)");equal(c.text(),"14");c.click();equal(this.dp.dates.length,3);equal(b,undefined);equal(a,"3/14/11")});test("Clear button: triggers change and changeDate events",function(){this.input=$('<input type="text" value="31-03-2011">').appendTo("#qunit-fixture").datepicker({format:"dd-mm-yyyy",clearBtn:true}).focus();this.dp=this.input.data("datepicker");this.picker=this.dp.picker;var a,b=0,c=0;this.input.on({changeDate:function(){c++},change:function(){b++}});this.input.focus();ok(this.picker.find(".datepicker-days").is(":visible"),"Days view visible");ok(this.picker.find(".datepicker-days tfoot .clear").is(":visible"),"Clear button visible");a=this.picker.find(".datepicker-days tfoot .clear");a.click();equal(b,1);equal(c,1)});test("setDate: triggers change and changeDate events",function(){this.input=$('<input type="text" value="31-03-2011">').appendTo("#qunit-fixture").datepicker({format:"dd-mm-yyyy"}).focus();this.dp=this.input.data("datepicker");this.picker=this.dp.picker;var a,b=0,c=0;this.input.on({changeDate:function(){c++},change:function(){b++}});this.input.focus();ok(this.picker.find(".datepicker-days").is(":visible"),"Days view visible");this.dp.setDate(new Date(2011,2,5));equal(b,1);equal(c,1)});test("paste must update the date",function(){var b="22-07-2015";var a={type:"paste",originalEvent:{clipboardData:{types:["text/plain"],getData:function(){return b}},preventDefault:function(){a.originalEvent.isDefaultPrevented=true},isDefaultPrevented:false}};this.input.trigger(a);datesEqual(this.dp.dates[0],UTCDate(2015,6,22));ok(a.originalEvent.isDefaultPrevented,"prevented original event")});test("clicking outside datepicker triggers 'hide' event",function(){var a=$("<div />");$("body").append(a);var b;this.input.on("hide",function(){b=true});a.trigger("mousedown");ok(b,"'hide' event is not triggered");a.remove()});test("Selecting date from previous month triggers changeMonth",function(){var b,a=0;this.input.on("changeMonth",function(){a++});b=this.picker.find(".datepicker-days tbody td:first");b.click();equal(a,1)});test("Selecting date from previous month in january triggers changeMonth/changeYear",function(){var c,b=0,a=0;this.input.val("01-01-2011");this.dp.update();this.input.on("changeMonth",function(){b++});this.input.on("changeYear",function(){a++});c=this.picker.find(".datepicker-days tbody td:first");c.click();equal(b,1);equal(a,1)});test("Selecting date from next month triggers changeMonth",function(){var b,a=0;this.input.on("changeMonth",function(){a++});b=this.picker.find(".datepicker-days tbody td:last");b.click();equal(a,1)});test("Selecting date from next month in december triggers changeMonth/changeYear",function(){var c,b=0,a=0;this.input.val("01-12-2011");this.dp.update();this.input.on("changeMonth",function(){b++});this.input.on("changeYear",function(){a++});c=this.picker.find(".datepicker-days tbody td:last");c.click();equal(b,1);equal(a,1)});test("Changing view mode triggers changeViewMode",function(){var b=-1,a=0;this.input.val("22-07-2016");this.dp.update();this.input.on("changeViewMode",function(c){b=c.viewMode;a++});this.picker.find(".datepicker-days .datepicker-switch").click();equal(a,1);equal(b,1);this.picker.find(".datepicker-months .datepicker-switch").click();equal(a,2);equal(b,2);this.picker.find(".datepicker-years .datepicker-switch").click();equal(a,3);equal(b,3);this.picker.find(".datepicker-decades .datepicker-switch").click();equal(a,4);equal(b,4)});test("Clicking inside content of date with custom beforeShowDay content works",function(){this.input=$('<input type="text" value="31-03-2011">').appendTo("#qunit-fixture").datepicker({format:"dd-mm-yyyy",beforeShowDay:function(c){return{content:"<div><div>"+c.getDate()+"</div></div>"}}}).focus();this.dp=this.input.data("datepicker");this.picker=this.dp.picker;var b,a=0;this.input.on("changeDate",function(){a++});b=this.picker.find(".datepicker-days tbody td:first div div");b.click();equal(a,1)});