/*! jQuery UI - v1.11.4 - 2015-03-13
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed MIT */
(function(a){"function"==typeof define&&define.amd?define(["jquery","./core","./mouse","./widget"],a):a(jQuery)})(function(a){return a.widget("ui.sortable",a.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(c,d,b){return c>=d&&d+b>c},_isFloating:function(b){return/left|right/.test(b.css("float"))||/inline|table-cell/.test(b.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(b,c){this._super(b,c),"handle"===b&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),a.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var b=this.items.length-1;b>=0;b--){this.items[b].item.removeData(this.widgetName+"-item")}return this},_mouseCapture:function(d,b){var c=null,g=!1,f=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(d),a(d.target).parents().each(function(){return a.data(this,f.widgetName+"-item")===f?(c=a(this),!1):void 0}),a.data(d.target,f.widgetName+"-item")===f&&(c=a(d.target)),c?!this.options.handle||b||(a(this.options.handle,c).find("*").addBack().each(function(){this===d.target&&(g=!0)}),g)?(this.currentItem=c,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(f,b,c){var h,g,d=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(f),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:f.pageX-this.offset.left,top:f.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(f),this.originalPageX=f.pageX,this.originalPageY=f.pageY,d.cursorAt&&this._adjustOffsetFromHelper(d.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),d.containment&&this._setContainment(),d.cursor&&"auto"!==d.cursor&&(g=this.document.find("body"),this.storedCursor=g.css("cursor"),g.css("cursor",d.cursor),this.storedStylesheet=a("<style>*{ cursor: "+d.cursor+" !important; }</style>").appendTo(g)),d.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",d.opacity)),d.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",d.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",f,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!c){for(h=this.containers.length-1;h>=0;h--){this.containers[h]._trigger("activate",f,this._uiHash(this))}}return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,f),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(f),!0},_mouseDrag:function(g){var b,d,k,j,f=this.options,c=!1;for(this.position=this._generatePosition(g),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-g.pageY<f.scrollSensitivity?this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop+f.scrollSpeed:g.pageY-this.overflowOffset.top<f.scrollSensitivity&&(this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop-f.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-g.pageX<f.scrollSensitivity?this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft+f.scrollSpeed:g.pageX-this.overflowOffset.left<f.scrollSensitivity&&(this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft-f.scrollSpeed)):(g.pageY-this.document.scrollTop()<f.scrollSensitivity?c=this.document.scrollTop(this.document.scrollTop()-f.scrollSpeed):this.window.height()-(g.pageY-this.document.scrollTop())<f.scrollSensitivity&&(c=this.document.scrollTop(this.document.scrollTop()+f.scrollSpeed)),g.pageX-this.document.scrollLeft()<f.scrollSensitivity?c=this.document.scrollLeft(this.document.scrollLeft()-f.scrollSpeed):this.window.width()-(g.pageX-this.document.scrollLeft())<f.scrollSensitivity&&(c=this.document.scrollLeft(this.document.scrollLeft()+f.scrollSpeed))),c!==!1&&a.ui.ddmanager&&!f.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,g)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),b=this.items.length-1;b>=0;b--){if(d=this.items[b],k=d.item[0],j=this._intersectsWithPointer(d),j&&d.instance===this.currentContainer&&k!==this.currentItem[0]&&this.placeholder[1===j?"next":"prev"]()[0]!==k&&!a.contains(this.placeholder[0],k)&&("semi-dynamic"===this.options.type?!a.contains(this.element[0],k):!0)){if(this.direction=1===j?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d)){break}this._rearrange(g,d),this._trigger("change",g,this._uiHash());break}}return this._contactContainers(g),a.ui.ddmanager&&a.ui.ddmanager.drag(this,g),this._trigger("sort",g,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(f,b){if(f){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,f),this.options.revert){var c=this,h=this.placeholder.offset(),g=this.options.axis,d={};g&&"x"!==g||(d.left=h.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),g&&"y"!==g||(d.top=h.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(d,parseInt(this.options.revert,10)||500,function(){c._clear(f)})}else{this._clear(f,b)}return !1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--){this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(d){var b=this._getItemsAsjQuery(d&&d.connected),c=[];return d=d||{},a(b).each(function(){var e=(a(d.item||this).attr(d.attribute||"id")||"").match(d.expression||/(.+)[\-=_](.+)/);e&&c.push((d.key||e[1]+"[]")+"="+(d.key&&d.expression?e[1]:e[2]))}),!c.length&&d.key&&c.push(d.key+"="),c.join("&")},toArray:function(d){var b=this._getItemsAsjQuery(d&&d.connected),c=[];return d=d||{},b.each(function(){c.push(a(d.item||this).attr(d.attribute||"id")||"")}),c},_intersectsWith:function(A){var v=this.positionAbs.left,m=v+this.helperProportions.width,B=this.positionAbs.top,j=B+this.helperProportions.height,g=A.left,b=g+A.width,q=A.top,y=q+A.height,k=this.offset.click.top,x=this.offset.click.left,f="x"===this.options.axis||B+k>q&&y>B+k,w="y"===this.options.axis||v+x>g&&b>v+x,z=f&&w;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>A[this.floating?"width":"height"]?z:v+this.helperProportions.width/2>g&&b>m-this.helperProportions.width/2&&B+this.helperProportions.height/2>q&&y>j-this.helperProportions.height/2},_intersectsWithPointer:function(c){var f="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,c.top,c.height),b="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,c.left,c.width),d=f&&b,h=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return d?this.floating?g&&"right"===g||"down"===h?2:1:h&&("down"===h?2:1):!1},_intersectsWithSides:function(c){var f=this._isOverAxis(this.positionAbs.top+this.offset.click.top,c.top+c.height/2,c.height),b=this._isOverAxis(this.positionAbs.left+this.offset.click.left,c.left+c.width/2,c.width),d=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return this.floating&&g?"right"===g&&b||"left"===g&&!b:d&&("down"===d&&f||"up"===d&&!f)},_getDragVerticalDirection:function(){var b=this.positionAbs.top-this.lastPositionAbs.top;return 0!==b&&(b>0?"down":"up")},_getDragHorizontalDirection:function(){var b=this.positionAbs.left-this.lastPositionAbs.left;return 0!==b&&(b>0?"right":"left")},refresh:function(b){return this._refreshItems(b),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var b=this.options;return b.connectWith.constructor===String?[b.connectWith]:b.connectWith},_getItemsAsjQuery:function(k){function g(){j.push(this)}var p,d,c,b,j=[],m=[],f=this._connectWith();if(f&&k){for(p=f.length-1;p>=0;p--){for(c=a(f[p],this.document[0]),d=c.length-1;d>=0;d--){b=a.data(c[d],this.widgetFullName),b&&b!==this&&!b.options.disabled&&m.push([a.isFunction(b.options.items)?b.options.items.call(b.element):a(b.options.items,b.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),b])}}}for(m.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),p=m.length-1;p>=0;p--){m[p][0].each(g)}return a(j)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(d){for(var c=0;b.length>c;c++){if(b[c]===d.item[0]){return !1}}return !0})},_refreshItems:function(t){this.items=[],this.containers=[this];var m,x,j,g,b,q,w,k,v=this.items,f=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):a(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready){for(m=u.length-1;m>=0;m--){for(j=a(u[m],this.document[0]),x=j.length-1;x>=0;x--){g=a.data(j[x],this.widgetFullName),g&&g!==this&&!g.options.disabled&&(f.push([a.isFunction(g.options.items)?g.options.items.call(g.element[0],t,{item:this.currentItem}):a(g.options.items,g.element),g]),this.containers.push(g))}}}for(m=f.length-1;m>=0;m--){for(b=f[m][1],q=f[m][0],x=0,k=q.length;k>x;x++){w=a(q[x]),w.data(this.widgetName+"-item",b),v.push({item:w,instance:b,width:0,height:0,left:0,top:0})}}},refreshPositions:function(d){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var b,c,g,f;for(b=this.items.length-1;b>=0;b--){c=this.items[b],c.instance!==this.currentContainer&&this.currentContainer&&c.item[0]!==this.currentItem[0]||(g=this.options.toleranceElement?a(this.options.toleranceElement,c.item):c.item,d||(c.width=g.outerWidth(),c.height=g.outerHeight()),f=g.offset(),c.left=f.left,c.top=f.top)}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(b=this.containers.length-1;b>=0;b--){f=this.containers[b].element.offset(),this.containers[b].containerCache.left=f.left,this.containers[b].containerCache.top=f.top,this.containers[b].containerCache.width=this.containers[b].element.outerWidth(),this.containers[b].containerCache.height=this.containers[b].element.outerHeight()}}return this},_createPlaceholder:function(d){d=d||this;var b,c=d.options;c.placeholder&&c.placeholder.constructor!==String||(b=c.placeholder,c.placeholder={element:function(){var e=d.currentItem[0].nodeName.toLowerCase(),f=a("<"+e+">",d.document[0]).addClass(b||d.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===e?d._createTrPlaceholder(d.currentItem.find("tr").eq(0),a("<tr>",d.document[0]).appendTo(f)):"tr"===e?d._createTrPlaceholder(d.currentItem,f):"img"===e&&f.attr("src",d.currentItem.attr("src")),b||f.css("visibility","hidden"),f},update:function(e,f){(!b||c.forcePlaceholderSize)&&(f.height()||f.height(d.currentItem.innerHeight()-parseInt(d.currentItem.css("paddingTop")||0,10)-parseInt(d.currentItem.css("paddingBottom")||0,10)),f.width()||f.width(d.currentItem.innerWidth()-parseInt(d.currentItem.css("paddingLeft")||0,10)-parseInt(d.currentItem.css("paddingRight")||0,10)))}}),d.placeholder=a(c.placeholder.element.call(d.element,d.currentItem)),d.currentItem.after(d.placeholder),c.placeholder.update(d,d.placeholder)},_createTrPlaceholder:function(d,b){var c=this;d.children().each(function(){a("<td>&#160;</td>",c.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(b)})},_contactContainers:function(t){var m,z,j,g,b,q,x,k,w,f,v=null,y=null;for(m=this.containers.length-1;m>=0;m--){if(!a.contains(this.currentItem[0],this.containers[m].element[0])){if(this._intersectsWith(this.containers[m].containerCache)){if(v&&a.contains(this.containers[m].element[0],v.element[0])){continue}v=this.containers[m],y=m}else{this.containers[m].containerCache.over&&(this.containers[m]._trigger("out",t,this._uiHash(this)),this.containers[m].containerCache.over=0)}}}if(v){if(1===this.containers.length){this.containers[y].containerCache.over||(this.containers[y]._trigger("over",t,this._uiHash(this)),this.containers[y].containerCache.over=1)}else{for(j=10000,g=null,w=v.floating||this._isFloating(this.currentItem),b=w?"left":"top",q=w?"width":"height",f=w?"clientX":"clientY",z=this.items.length-1;z>=0;z--){a.contains(this.containers[y].element[0],this.items[z].item[0])&&this.items[z].item[0]!==this.currentItem[0]&&(x=this.items[z].item.offset()[b],k=!1,t[f]-x>this.items[z][q]/2&&(k=!0),j>Math.abs(t[f]-x)&&(j=Math.abs(t[f]-x),g=this.items[z],this.direction=k?"up":"down"))}if(!g&&!this.options.dropOnEmpty){return}if(this.currentContainer===this.containers[y]){return this.currentContainer.containerCache.over||(this.containers[y]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0}g?this._rearrange(t,g,null,!0):this._rearrange(t,null,this.containers[y].element,!0),this._trigger("change",t,this._uiHash()),this.containers[y]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[y],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[y]._trigger("over",t,this._uiHash(this)),this.containers[y].containerCache.over=1}}},_createHelper:function(d){var b=this.options,c=a.isFunction(b.helper)?a(b.helper.apply(this.element[0],[d,this.currentItem])):"clone"===b.helper?this.currentItem.clone():this.currentItem;return c.parents("body").length||a("parent"!==b.appendTo?b.appendTo:this.currentItem[0].parentNode)[0].appendChild(c[0]),c[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!c[0].style.width||b.forceHelperSize)&&c.width(this.currentItem.width()),(!c[0].style.height||b.forceHelperSize)&&c.height(this.currentItem.height()),c},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left" in b&&(this.offset.click.left=b.left+this.margins.left),"right" in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top" in b&&(this.offset.click.top=b.top+this.margins.top),"bottom" in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var b=this.currentItem.position();return{top:b.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:b.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var d,b,c,f=this.options;"parent"===f.containment&&(f.containment=this.helper[0].parentNode),("document"===f.containment||"window"===f.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===f.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===f.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(f.containment)||(d=a(f.containment)[0],b=a(f.containment).offset(),c="hidden"!==a(d).css("overflow"),this.containment=[b.left+(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0)-this.margins.left,b.top+(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0)-this.margins.top,b.left+(c?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderLeftWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,b.top+(c?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderTopWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(d,b){b||(b=this.position);var c="absolute"===d?1:-1,g="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(g[0].tagName);return{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:g.scrollTop())*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:g.scrollLeft())*c}},_generatePosition:function(j){var c,f,l=this.options,k=j.pageX,g=j.pageY,d="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,b=/(html|body)/i.test(d[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(j.pageX-this.offset.click.left<this.containment[0]&&(k=this.containment[0]+this.offset.click.left),j.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),j.pageX-this.offset.click.left>this.containment[2]&&(k=this.containment[2]+this.offset.click.left),j.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),l.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/l.grid[1])*l.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-l.grid[1]:c+l.grid[1]:c,f=this.originalPageX+Math.round((k-this.originalPageX)/l.grid[0])*l.grid[0],k=this.containment?f-this.offset.click.left>=this.containment[0]&&f-this.offset.click.left<=this.containment[2]?f:f-this.offset.click.left>=this.containment[0]?f-l.grid[0]:f+l.grid[0]:f)),{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():b?0:d.scrollTop()),left:k-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():b?0:d.scrollLeft())}},_rearrange:function(c,f,b,d){b?b[0].appendChild(this.placeholder[0]):f.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?f.item[0]:f.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var g=this.counter;this._delay(function(){g===this.counter&&this.refreshPositions(!d)})},_clear:function(c,f){function b(j,k,h){return function(e){h._trigger(j,e,k._uiHash(k))}}this.reverting=!1;var d,g=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(d in this._storedCSS){("auto"===this._storedCSS[d]||"static"===this._storedCSS[d])&&(this._storedCSS[d]="")}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}for(this.fromOutside&&!f&&g.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||f||g.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(f||(g.push(function(e){this._trigger("remove",e,this._uiHash())}),g.push(function(e){return function(h){e._trigger("receive",h,this._uiHash(this))}}.call(this,this.currentContainer)),g.push(function(e){return function(h){e._trigger("update",h,this._uiHash(this))}}.call(this,this.currentContainer)))),d=this.containers.length-1;d>=0;d--){f||g.push(b("deactivate",this,this.containers[d])),this.containers[d].containerCache.over&&(g.push(b("out",this,this.containers[d])),this.containers[d].containerCache.over=0)}if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,f||this._trigger("beforeStop",c,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!f){for(d=0;g.length>d;d++){g[d].call(this,c)}this._trigger("stop",c,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(c){var b=c||this;return{helper:b.helper,placeholder:b.placeholder||a([]),position:b.position,originalPosition:b.originalPosition,offset:b.positionAbs,item:b.currentItem,sender:c?c.element:null}}})});