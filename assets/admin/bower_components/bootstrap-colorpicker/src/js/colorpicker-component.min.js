var Colorpicker=function(d,c){this.element=$(d).addClass("colorpicker-element");this.options=$.extend(true,{},defaults,this.element.data(),c);this.component=this.options.component;this.component=(this.component!==false)?this.element.find(this.component):false;if(this.component&&(this.component.length===0)){this.component=false}this.container=(this.options.container===true)?this.element:this.options.container;this.container=(this.container!==false)?$(this.container):false;this.input=this.element.is("input")?this.element:(this.options.input?this.element.find(this.options.input):false);if(this.input&&(this.input.length===0)){this.input=false}this.color=this.createColor(this.options.color!==false?this.options.color:this.getValue());this.format=this.options.format!==false?this.options.format:this.color.origFormat;if(this.options.color!==false){this.updateInput(this.color);this.updateData(this.color)}var e=this.picker=$(this.options.template);if(this.options.customClass){e.addClass(this.options.customClass)}if(this.options.inline){e.addClass("colorpicker-inline colorpicker-visible")}else{e.addClass("colorpicker-hidden")}if(this.options.horizontal){e.addClass("colorpicker-horizontal")}if((["rgba","hsla","alias"].indexOf(this.format)!==-1)||this.options.format===false||this.getValue()==="transparent"){e.addClass("colorpicker-with-alpha")}if(this.options.align==="right"){e.addClass("colorpicker-right")}if(this.options.inline===true){e.addClass("colorpicker-no-arrow")}if(this.options.colorSelectors){var b=this,a=b.picker.find(".colorpicker-selectors");if(a.length>0){$.each(this.options.colorSelectors,function(g,f){var h=$("<i />").addClass("colorpicker-selectors-color").css("background-color",f).data("class",g).data("alias",g);h.on("mousedown.colorpicker touchstart.colorpicker",function(i){i.preventDefault();b.setValue(b.format==="alias"?$(this).data("alias"):$(this).css("background-color"))});a.append(h)});a.show().addClass("colorpicker-visible")}}e.on("mousedown.colorpicker touchstart.colorpicker",$.proxy(function(f){if(f.target===f.currentTarget){f.preventDefault()}},this));e.find(".colorpicker-saturation, .colorpicker-hue, .colorpicker-alpha").on("mousedown.colorpicker touchstart.colorpicker",$.proxy(this.mousedown,this));e.appendTo(this.container?this.container:$("body"));if(this.input!==false){this.input.on({"keyup.colorpicker":$.proxy(this.keyup,this)});this.input.on({"change.colorpicker":$.proxy(this.change,this)});if(this.component===false){this.element.on({"focus.colorpicker":$.proxy(this.show,this)})}if(this.options.inline===false){this.element.on({"focusout.colorpicker":$.proxy(this.hide,this)})}}if(this.component!==false){this.component.on({"click.colorpicker":$.proxy(this.show,this)})}if((this.input===false)&&(this.component===false)){this.element.on({"click.colorpicker":$.proxy(this.show,this)})}if((this.input!==false)&&(this.component!==false)&&(this.input.attr("type")==="color")){this.input.on({"click.colorpicker":$.proxy(this.show,this),"focus.colorpicker":$.proxy(this.show,this)})}this.update();$($.proxy(function(){this.element.trigger("create")},this))};Colorpicker.Color=Color;Colorpicker.prototype={constructor:Colorpicker,destroy:function(){this.picker.remove();this.element.removeData("colorpicker","color").off(".colorpicker");if(this.input!==false){this.input.off(".colorpicker")}if(this.component!==false){this.component.off(".colorpicker")}this.element.removeClass("colorpicker-element");this.element.trigger({type:"destroy"})},reposition:function(){if(this.options.inline!==false||this.options.container){return false}var b=this.container&&this.container[0]!==window.document.body?"position":"offset";var a=this.component||this.element;var c=a[b]();if(this.options.align==="right"){c.left-=this.picker.outerWidth()-a.outerWidth()}this.picker.css({top:c.top+a.outerHeight(),left:c.left})},show:function(a){if(this.isDisabled()){return}this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden");this.reposition();$(window).on("resize.colorpicker",$.proxy(this.reposition,this));if(a&&(!this.hasInput()||this.input.attr("type")==="color")){if(a.stopPropagation&&a.preventDefault){a.stopPropagation();a.preventDefault()}}if((this.component||!this.input)&&(this.options.inline===false)){$(window.document).on({"mousedown.colorpicker":$.proxy(this.hide,this)})}this.element.trigger({type:"showPicker",color:this.color})},hide:function(a){if((typeof a!=="undefined")&&a.target){if($(a.currentTarget).parents(".colorpicker").length>0||$(a.target).parents(".colorpicker").length>0){return false}}this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible");$(window).off("resize.colorpicker",this.reposition);$(window.document).off({"mousedown.colorpicker":this.hide});this.update();this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(a){a=a||this.color.toString(this.format,false);this.element.data("color",a);return a},updateInput:function(a){a=a||this.color.toString(this.format,false);if(this.input!==false){this.input.prop("value",a);this.input.trigger("change")}return a},updatePicker:function(c){if(typeof c!=="undefined"){this.color=this.createColor(c)}var a=(this.options.horizontal===false)?this.options.sliders:this.options.slidersHorz;var b=this.picker.find("i");if(b.length===0){return}if(this.options.horizontal===false){a=this.options.sliders;b.eq(1).css("top",a.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",a.alpha.maxTop*(1-this.color.value.a))}else{a=this.options.slidersHorz;b.eq(1).css("left",a.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",a.alpha.maxLeft*(1-this.color.value.a))}b.eq(0).css({top:a.saturation.maxTop-this.color.value.b*a.saturation.maxTop,left:this.color.value.s*a.saturation.maxLeft});this.picker.find(".colorpicker-saturation").css("backgroundColor",(this.options.hexNumberSignPrefix?"":"#")+this.color.toHex(this.color.value.h,1,1,1));this.picker.find(".colorpicker-alpha").css("backgroundColor",(this.options.hexNumberSignPrefix?"":"#")+this.color.toHex());this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(this.format,true));return c},updateComponent:function(c){var a;if(typeof c!=="undefined"){a=this.createColor(c)}else{a=this.color}if(this.component!==false){var b=this.component.find("i").eq(0);if(b.length>0){b.css({backgroundColor:a.toString(this.format,true)})}else{this.component.css({backgroundColor:a.toString(this.format,true)})}}return a.toString(this.format,false)},update:function(a){var b;if((this.getValue(false)!==false)||(a===true)){b=this.updateComponent();this.updateInput(b);this.updateData(b);this.updatePicker()}return b},setValue:function(a){this.color=this.createColor(a);this.update(true);this.element.trigger({type:"changeColor",color:this.color,value:a})},createColor:function(a){return new Color(a?a:null,this.options.colorSelectors,this.options.fallbackColor?this.options.fallbackColor:this.color,this.options.fallbackFormat,this.options.hexNumberSignPrefix)},getValue:function(a){a=(typeof a==="undefined")?this.options.fallbackColor:a;var b;if(this.hasInput()){b=this.input.val()}else{b=this.element.data("color")}if((b===undefined)||(b==="")||(b===null)){b=a}return b},hasInput:function(){return(this.input!==false)},isDisabled:function(){if(this.hasInput()){return(this.input.prop("disabled")===true)}return false},disable:function(){if(this.hasInput()){this.input.prop("disabled",true);this.element.trigger({type:"disable",color:this.color,value:this.getValue()});return true}return false},enable:function(){if(this.hasInput()){this.input.prop("disabled",false);this.element.trigger({type:"enable",color:this.color,value:this.getValue()});return true}return false},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(d){if(!d.pageX&&!d.pageY&&d.originalEvent&&d.originalEvent.touches){d.pageX=d.originalEvent.touches[0].pageX;d.pageY=d.originalEvent.touches[0].pageY}d.stopPropagation();d.preventDefault();var c=$(d.target);var b=c.closest("div");var a=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!b.is(".colorpicker")){if(b.is(".colorpicker-saturation")){this.currentSlider=$.extend({},a.saturation)}else{if(b.is(".colorpicker-hue")){this.currentSlider=$.extend({},a.hue)}else{if(b.is(".colorpicker-alpha")){this.currentSlider=$.extend({},a.alpha)}else{return false}}}var f=b.offset();this.currentSlider.guide=b.find("i")[0].style;this.currentSlider.left=d.pageX-f.left;this.currentSlider.top=d.pageY-f.top;this.mousePointer={left:d.pageX,top:d.pageY};$(window.document).on({"mousemove.colorpicker":$.proxy(this.mousemove,this),"touchmove.colorpicker":$.proxy(this.mousemove,this),"mouseup.colorpicker":$.proxy(this.mouseup,this),"touchend.colorpicker":$.proxy(this.mouseup,this)}).trigger("mousemove")}return false},mousemove:function(c){if(!c.pageX&&!c.pageY&&c.originalEvent&&c.originalEvent.touches){c.pageX=c.originalEvent.touches[0].pageX;c.pageY=c.originalEvent.touches[0].pageY}c.stopPropagation();c.preventDefault();var b=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((c.pageX||this.mousePointer.left)-this.mousePointer.left)));var a=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((c.pageY||this.mousePointer.top)-this.mousePointer.top)));this.currentSlider.guide.left=b+"px";this.currentSlider.guide.top=a+"px";if(this.currentSlider.callLeft){this.color[this.currentSlider.callLeft].call(this.color,b/this.currentSlider.maxLeft)}if(this.currentSlider.callTop){this.color[this.currentSlider.callTop].call(this.color,a/this.currentSlider.maxTop)}if(this.options.format===false&&(this.currentSlider.callTop==="setAlpha"||this.currentSlider.callLeft==="setAlpha")){if(this.color.value.a!==1){this.format="rgba";this.color.origFormat="rgba"}else{this.format="hex";this.color.origFormat="hex"}}this.update(true);this.element.trigger({type:"changeColor",color:this.color});return false},mouseup:function(a){a.stopPropagation();a.preventDefault();$(window.document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup});return false},change:function(a){this.keyup(a)},keyup:function(a){if((a.keyCode===38)){if(this.color.value.a<1){this.color.value.a=Math.round((this.color.value.a+0.01)*100)/100}this.update(true)}else{if((a.keyCode===40)){if(this.color.value.a>0){this.color.value.a=Math.round((this.color.value.a-0.01)*100)/100}this.update(true)}else{this.color=this.createColor(this.input.val());if(this.color.origFormat&&this.options.format===false){this.format=this.color.origFormat}if(this.getValue(false)!==false){this.updateData();this.updateComponent();this.updatePicker()}}}this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}};$.colorpicker=Colorpicker;$.fn.colorpicker=function(c){var a=Array.prototype.slice.call(arguments,1),d=(this.length===1),b=null;var e=this.each(function(){var h=$(this),g=h.data("colorpicker"),f=((typeof c==="object")?c:{});if(!g){g=new Colorpicker(this,f);h.data("colorpicker",g)}if(typeof c==="string"){if($.isFunction(g[c])){b=g[c].apply(g,a)}else{if(a.length){g[c]=a[0]}b=g[c]}}else{b=h}});return d?b:e};$.fn.colorpicker.constructor=Colorpicker;